package cat.prv.test;

import static org.junit.Assert.*;

import java.util.List;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;

import org.springframework.test.context.ActiveProfiles;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.ContextHierarchy;
import org.springframework.test.context.TestPropertySource;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
import org.springframework.test.context.web.WebAppConfiguration;

import cat.prv.om.dao.TblServicesDao;
import cat.prv.om.dao.TransDtlDao;
import cat.prv.om.dao.TransHdrDao;
import cat.prv.om.entity.TblServices;
import cat.prv.om.entity.TransDtl;
import cat.prv.om.entity.TransHdr;


@TestPropertySource(properties = { "spring.profiles.active=dev","jboss.server.log.dir=D:\\Development\\Application Server\\wildfly-10.1.0.Final\\standalone\\log"})
@ActiveProfiles("dev")
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = {"file:src/main/webapp/WEB-INF/spring/ApplicationContext.xml",
		"file:src/main/webapp/WEB-INF/spring-servlet.xml",})
@WebAppConfiguration
public class ApplicationContextTest {

	@Autowired
	TransHdrDao transHdrDao;
	
	@Autowired
	TransDtlDao transDtlDao;
	
	@Autowired
	TblServicesDao tblServicesDao;
	
	@Test
    public void testTrans() {
		
		
		testTransHdr();
		testTransDtl();
        testTblServices();
        
    }
	
	
    public void testTransHdr() {
		
		System.out.println("Test TranHdr Started");
        TransHdr transHdr = transHdrDao.getTransHdr("U1610190000018865313");
        List<TransDtl> transDtls = transHdr.getTransDtl();
        assertEquals(transHdr.getTransId(), "U1610190000018865313");
        System.out.println("TransHdr "+transHdr.getTransId()+" Type : "+transHdr.getOrderType());
        transDtls.stream().forEach(d -> System.out.println(d.getTransDtlId()));
        System.out.println("Test TranHdr Completed ");
        
        
    }
	
	
	public void testTransDtl(){
		System.out.println("Test TranDtl Started");
		TransDtl transDtl = transDtlDao.getTransDtl("D1610190000041466173");
		assertEquals(transDtl.getTransDtlId(), "D1610190000041466173");
		assertEquals(transDtl.getTransHdr().getTransId(), "U1610190000018865313");
		
		List<TransDtl> transDtls = transDtlDao.getTransDtlByTransId("U1610190000018865313");
		
		transDtls.stream().forEach(d -> {
			System.out.println(d);
			assertEquals(transDtl.getTransHdr().getTransId(), "U1610190000018865313");
		});
		
        System.out.println("Test TranDtl Completed ");
	}
	
	public void testTblServices(){
		System.out.println("Test TblServices Started");
		TblServices tblServices = tblServicesDao.getTblServiceByMsisdn("66887998168");
		assertEquals(tblServices.getMsisdn(), "66887998168");
		assertEquals(tblServicesDao.getTblServices(tblServices.getServicesId()).getServicesId(), tblServices.getServicesId());
		System.out.println(tblServices);
        System.out.println("Test TblServices Completed ");
		
	}
	
	
	 
	
}
